
# adb-up-role

Create an [Atomic Developer Bundle (ADB)](https://github.com/projectatomic/adb-atomic-developer-bundle) virtual machine configured to work with [Ansible Container](https://github.com/ansible/ansible-container).

Performs the following tasks:

- Downloads the [OpenShift Vagrantfile](https://raw.githubusercontent.com/projectatomic/adb-atomic-developer-bundle/master/components/centos/centos-openshift-setup/Vagrantfile), and sets the OpenShift version
- Creates a new VM
- Installs require Vagrant plugins
- On the host machine adds an entry for *openshift.adb* to /etc/hosts, which points to the IP address assigned to the new VM
- Generates new client and server certificates for the Docker daemon running on the VM. Certificates are installed on the VM, and copied to the host. The new certs are created with *openshift.adb* as the server name, and the IP address as an alternate name.
- Restarts the Docker daemon on the VM
- Creates *setenv.sh*, a script you can source to configure your shell environment to use the Docker daemon running inside the new VM

## Prerequisites

Before you can use this role, you need to have the following installed:

- Virtualbox 5.0.26+
- Vagrant 1.9.1+

## Known issues

Ruby gem error
--------------

If you're running on OSX, you'll likely see the following message:

```
Ignoring eventmachine-1.0.9.1 because its extensions are not built.  Try: gem pristine eventmachine --version 1.0.9.1
```

This seems to be coming from the [Landrush](https://github.com/vagrant-landrush/landrush) plugin. See issue [#292](https://github.com/vagrant-landrush/landrush/issues/292). And, it seems safe to ignore. The VM runs fine, and `vagrant` commands work.

Using service-manager to set the envirionment
---------------------------------------------

If you read the ADB documentation, you'll see references to the command `vagrant service-manager env`. In general, don't use this command. It generates new certificates when you run it, and the certificates will not be bound to the *openshit.adb* host. They're bound to *example.com*, which works fine for the `docker` command, but breaks Ansible Container. 

Rather than using service-manager, use the command `source setenv.sh`. This will execute the script generated by this role, setting the DOCKER variables in your environment to point to the Docker daemon running inside the ADB virtual machine.
